{% extends "base.html" %}
{% load static %}

{% block nav-home %}active{% endblock %}

{% block customcss %}<link href="{% static 'genform/css/metasat.css' %}" rel="stylesheet">{% endblock %}

{% block title %}
    Success
{% endblock %}

{% block body %}
<div class = "container">
  <div class="topspacing"></div>
  <div style="margin-top: 80px;
  overflow-y: hidden;
  overflow-x: hidden;
  z-index: 8;"></div>
<h1> Success </h1>
<h3> Click button below to download your JSONLD file.</h3>
<form action="download_file" method="post">
  {% csrf_token %}
<div class="buttonHolder">
  <input type="hidden" name="data" value= "{{ outfile }}">
  <input type="submit" name="download" value="Download JSONLD" class="btn btn-primary dbutton" id="dbutton">
</div>
</div>

<script>
  $( document ).ready(function() {

  function getCookie(c_name)
  {
      if (document.cookie.length > 0)
      {
          c_start = document.cookie.indexOf(c_name + "=");
          if (c_start != -1)
          {
              c_start = c_start + c_name.length + 1;
              c_end = document.cookie.indexOf(";", c_start);
              if (c_end == -1) c_end = document.cookie.length;
              return unescape(document.cookie.substring(c_start,c_end));
          }
      }
      return "";
   }
    });

  $(".sure").click(function(event){
     var data = $('outfile').get(0);
     console.log("dbuton")
     console.log(data)

     $.ajaxSetup({
         headers: { "X-CSRFToken": getCookie("csrftoken") }

     });

     $.ajax(
     {
         url: "/download_file",
         type:"POST",
         data: data,
         // cache: false,
         // contentType: false,
         // processData: false,

         success: function(result)
         {

       },



           error: function (xhr, ajaxOptions, thrownError) {
             console.log("ERROR")
             alert("Error downloading file.")
           // alert(xhr.status);
           // alert(thrownError);
      },
    });
   });
</script>

{% endblock %}
